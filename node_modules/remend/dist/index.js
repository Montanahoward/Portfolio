var tn=Object.defineProperty,sn=Object.defineProperties;var on=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var ln=Object.prototype.hasOwnProperty,an=Object.prototype.propertyIsEnumerable;var O=(n,r,e)=>r in n?tn(n,r,{enumerable:true,configurable:true,writable:true,value:e}):n[r]=e,I=(n,r)=>{for(var e in r||(r={}))ln.call(r,e)&&O(n,e,r[e]);if(M)for(var e of M(r))an.call(r,e)&&O(n,e,r[e]);return n},b=(n,r)=>sn(n,on(r));var _=/(\*\*)([^*]*\*?)$/,C=/(__)([^_]*?)$/,L=/(\*\*\*)([^*]*?)$/,E=/(\*)([^*]*?)$/,y=/(_)([^_]*?)$/,R=/(`)([^`]*?)$/,N=/(~~)([^~]*?)$/,u=/^[\s_~*`]*$/,A=/^[\s]*[-*+][\s]+$/,U=/[\p{L}\p{N}_]/u,W=/^```[^`\n]*```?$/,H=/^\*{4,}$/;var D=/(__)([^_]+)_$/,K=/(~~)([^~]+)~$/,w=/__/g,T=/~~/g;var f=n=>{if(!n)return  false;let r=n.charCodeAt(0);return r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||r===95?true:U.test(n)},d=(n,r)=>{let e=false;for(let i=0;i<r;i+=1)n[i]==="`"&&n[i+1]==="`"&&n[i+2]==="`"&&(e=!e,i+=2);return e},G=(n,r)=>{let e=1;for(let i=r-1;i>=0;i-=1)if(n[i]==="]")e+=1;else if(n[i]==="["&&(e-=1,e===0))return i;return  -1},P=(n,r)=>{let e=1;for(let i=r+1;i<n.length;i+=1)if(n[i]==="[")e+=1;else if(n[i]==="]"&&(e-=1,e===0))return i;return  -1},h=(n,r)=>{let e=false,i=false;for(let t=0;t<n.length&&t<r;t+=1){if(n[t]==="\\"&&n[t+1]==="$"){t+=1;continue}n[t]==="$"&&(n[t+1]==="$"?(i=!i,t+=1,e=false):i||(e=!e));}return e||i},cn=(n,r)=>{for(let e=r;e<n.length;e+=1){if(n[e]===")")return  true;if(n[e]===`
`)return  false}return  false},p=(n,r)=>{for(let e=r-1;e>=0;e-=1){if(n[e]===")")return  false;if(n[e]==="(")return e>0&&n[e-1]==="]"?cn(n,r):false;if(n[e]===`
`)return  false}return  false},k=(n,r,e)=>{let i=0;for(let s=r-1;s>=0;s-=1)if(n[s]===`
`){i=s+1;break}let t=n.length;for(let s=r;s<n.length;s+=1)if(n[s]===`
`){t=s;break}let o=n.substring(i,t),a=0,l=false;for(let s of o)if(s===e)a+=1;else if(s!==" "&&s!=="	"){l=true;break}return a>=3&&!l};var un=/^(\s*(?:[-*+]|\d+[.)]) +)>(=?\s*[$]?\d)/gm,F=n=>!n||typeof n!="string"||!n.includes(">")?n:n.replace(un,(r,e,i,t)=>d(n,t)?r:`${e}\\>${i}`);var fn=(n,r,e)=>{if(e!==" "&&e!=="	")return  false;let i=0;for(let t=r-1;t>=0;t-=1)if(n[t]===`
`){i=t+1;break}for(let t=i;t<r;t+=1)if(n[t]!==" "&&n[t]!=="	")return  false;return  true},dn=(n,r,e,i)=>e==="\\"||n.includes("$")&&h(n,r)?true:e!=="*"&&i==="*"?(r<n.length-2?n[r+2]:"")!=="*":!!(e==="*"||e&&i&&f(e)&&f(i)||(!e||e===" "||e==="	"||e===`
`)&&(!i||i===" "||i==="	"||i===`
`)||fn(n,r,i)),X=n=>{let r=0,e=n.length;for(let i=0;i<e;i+=1){if(n[i]!=="*")continue;let t=i>0?n[i-1]:"",o=i<e-1?n[i+1]:"";dn(n,i,t,o)||(r+=1);}return r},gn=(n,r,e,i)=>!!(e==="\\"||n.includes("$")&&h(n,r)||p(n,r)||e==="_"||i==="_"||e&&i&&f(e)&&f(i)),hn=n=>{let r=0,e=n.length;for(let i=0;i<e;i+=1){if(n[i]!=="_")continue;let t=i>0?n[i-1]:"",o=i<e-1?n[i+1]:"";gn(n,i,t,o)||(r+=1);}return r},mn=n=>{let r=0,e=0;for(let i=0;i<n.length;i+=1)n[i]==="*"?e+=1:(e>=3&&(r+=Math.floor(e/3)),e=0);return e>=3&&(r+=Math.floor(e/3)),r},pn=(n,r,e)=>{if(!r||u.test(r))return  true;let t=n.substring(0,e).lastIndexOf(`
`),o=t===-1?0:t+1,a=n.substring(o,e);return A.test(a)&&r.includes(`
`)?true:k(n,e,"*")},v=n=>{let r=n.match(_);if(!r)return n;let e=r[2],i=n.lastIndexOf(r[1]);return d(n,i)||pn(n,e,i)?n:(n.match(/\*\*/g)||[]).length%2===1?e.endsWith("*")?`${n}*`:`${n}**`:n},kn=(n,r,e)=>{if(!r||u.test(r))return  true;let t=n.substring(0,e).lastIndexOf(`
`),o=t===-1?0:t+1,a=n.substring(o,e);return A.test(a)&&r.includes(`
`)?true:k(n,e,"_")},z=n=>{let r=n.match(C);if(!r){let o=n.match(D);if(o){let a=n.lastIndexOf(o[1]);if(!d(n,a)&&(n.match(w)||[]).length%2===1)return `${n}_`}return n}let e=r[2],i=n.lastIndexOf(r[1]);return d(n,i)||kn(n,e,i)?n:(n.match(/__/g)||[]).length%2===1?`${n}__`:n},In=n=>{for(let r=0;r<n.length;r+=1)if(n[r]==="*"&&n[r-1]!=="*"&&n[r+1]!=="*"&&n[r-1]!=="\\"&&!h(n,r)){let e=r>0?n[r-1]:"",i=r<n.length-1?n[r+1]:"";if((!e||e===" "||e==="	"||e===`
`)&&(!i||i===" "||i==="	"||i===`
`)||e&&i&&f(e)&&f(i))continue;return r}return  -1},Y=n=>{if(!n.match(E))return n;let e=In(n);if(e===-1||d(n,e))return n;let i=n.substring(e+1);return !i||u.test(i)?n:X(n)%2===1?`${n}*`:n},j=n=>{for(let r=0;r<n.length;r+=1)if(n[r]==="_"&&n[r-1]!=="_"&&n[r+1]!=="_"&&n[r-1]!=="\\"&&!h(n,r)&&!p(n,r)){let e=r>0?n[r-1]:"",i=r<n.length-1?n[r+1]:"";if(e&&i&&f(e)&&f(i))continue;return r}return  -1},bn=n=>{let r=n.length;for(;r>0&&n[r-1]===`
`;)r-=1;if(r<n.length){let e=n.slice(0,r),i=n.slice(r);return `${e}_${i}`}return `${n}_`},An=n=>{if(!n.endsWith("**"))return null;let r=n.slice(0,-2);if((r.match(/\*\*/g)||[]).length%2!==1)return null;let i=r.indexOf("**"),t=j(r);return i!==-1&&t!==-1&&i<t?`${r}_**`:null},Q=n=>{if(!n.match(y))return n;let e=j(n);if(e===-1||d(n,e))return n;let i=n.substring(e+1);if(!i||u.test(i))return n;if(hn(n)%2===1){let o=An(n);return o!==null?o:bn(n)}return n},Tn=n=>{let r=(n.match(/\*\*/g)||[]).length,e=X(n);return r%2===0&&e%2===0},Pn=(n,r,e)=>!r||u.test(r)||d(n,e)?true:k(n,e,"*"),Z=n=>{if(H.test(n))return n;let r=n.match(L);if(!r)return n;let e=r[2],i=n.lastIndexOf(r[1]);return Pn(n,e,i)?n:mn(n)%2===1?Tn(n)?n:`${n}***`:n};var g=(n,r)=>{let e=false,i=false;for(let t=0;t<r;t+=1){if(n.substring(t,t+3)==="```"){i=!i,t+=2;continue}!i&&n[t]==="`"&&(e=!e);}return e||i},Sn=(n,r)=>{let e=n.substring(r,r+3)==="```",i=r>0&&n.substring(r-1,r+2)==="```",t=r>1&&n.substring(r-2,r+1)==="```";return e||i||t},q=n=>{let r=0;for(let e=0;e<n.length;e+=1)n[e]==="`"&&!Sn(n,e)&&(r+=1);return r};var $n=/<[a-zA-Z/][^>]*$/,J=n=>{let r=n.match($n);return !r||r.index===void 0||g(n,r.index)?n:n.substring(0,r.index).trimEnd()};var Bn=n=>!n.match(W)||n.includes(`
`)?null:n.endsWith("``")&&!n.endsWith("```")?`${n}\``:n,Mn=n=>(n.match(/```/g)||[]).length%2===1,V=n=>{let r=Bn(n);if(r!==null)return r;let e=n.match(R);if(e&&!Mn(n)){let i=e[2];if(!i||u.test(i))return n;if(q(n)%2===1)return `${n}\``}return n};var On=(n,r)=>r>=2&&n.substring(r-2,r+1)==="```"||r>=1&&n.substring(r-1,r+2)==="```"||r<=n.length-3&&n.substring(r,r+3)==="```",_n=n=>{let r=0,e=false;for(let i=0;i<n.length-1;i+=1)n[i]==="`"&&!On(n,i)&&(e=!e),!e&&n[i]==="$"&&n[i+1]==="$"&&(r+=1,i+=1);return r},Cn=n=>{let r=n.indexOf("$$");return r!==-1&&n.indexOf(`
`,r)!==-1&&!n.endsWith(`
`)?`${n}
$$`:`${n}$$`},x=n=>_n(n)%2===0?n:Cn(n);var Ln=(n,r,e)=>{if(n.substring(r+2).includes(")"))return null;let t=G(n,r);if(t===-1||g(n,t))return null;let o=t>0&&n[t-1]==="!",a=o?t-1:t,l=n.substring(0,a);if(o)return l;let s=n.substring(t+1,r);return e==="text-only"?`${l}${s}`:`${l}[${s}](streamdown:incomplete-link)`},nn=(n,r)=>{for(let e=0;e<=r;e++)if(n[e]==="["&&!g(n,e)){if(e>0&&n[e-1]==="!")continue;let i=P(n,e);if(i===-1)return e;if(i+1<n.length&&n[i+1]==="("){let t=n.indexOf(")",i+2);t!==-1&&(e=t);}}return  -1},En=(n,r,e)=>{let i=r>0&&n[r-1]==="!",t=i?r-1:r,o=n.substring(r+1);if(!o.includes("]")){let l=n.substring(0,t);if(i)return l;if(e==="text-only"){let s=nn(n,r);return s!==-1?n.substring(0,s)+n.substring(s+1):`${l}${o}`}return `${n}](streamdown:incomplete-link)`}if(P(n,r)===-1){let l=n.substring(0,t);if(i)return l;if(e==="text-only"){let s=nn(n,r);if(s!==-1)return n.substring(0,s)+n.substring(s+1);let m=n.substring(r+1);return `${l}${m}`}return `${n}](streamdown:incomplete-link)`}return null},S=(n,r="protocol")=>{let e=n.lastIndexOf("](");if(e!==-1&&!g(n,e)){let i=Ln(n,e,r);if(i!==null)return i}for(let i=n.length-1;i>=0;i-=1)if(n[i]==="["&&!g(n,i)){let t=En(n,i,r);if(t!==null)return t}return n};var yn=/^-{1,2}$/,Rn=/^[\s]*-{1,2}[\s]+$/,Nn=/^={1,2}$/,Un=/^[\s]*={1,2}[\s]+$/,rn=n=>{if(!n||typeof n!="string")return n;let r=n.lastIndexOf(`
`);if(r===-1)return n;let e=n.substring(r+1),i=n.substring(0,r),t=e.trim();if(yn.test(t)&&!e.match(Rn)){let a=i.split(`
`).at(-1);if(a&&a.trim().length>0)return `${n}\u200B`}if(Nn.test(t)&&!e.match(Un)){let a=i.split(`
`).at(-1);if(a&&a.trim().length>0)return `${n}\u200B`}return n};var en=n=>{let r=n.match(N);if(r){let e=r[2];if(!e||u.test(e))return n;if((n.match(T)||[]).length%2===1)return `${n}~~`}else if(n.match(K)&&(n.match(T)||[]).length%2===1)return `${n}~`;return n};var $=n=>n!==false,c={COMPARISON_OPERATORS:-10,HTML_TAGS:-5,SETEXT_HEADINGS:0,LINKS:10,BOLD_ITALIC:20,BOLD:30,ITALIC_DOUBLE_UNDERSCORE:40,ITALIC_SINGLE_ASTERISK:41,ITALIC_SINGLE_UNDERSCORE:42,INLINE_CODE:50,STRIKETHROUGH:60,KATEX:70,DEFAULT:100},Wn=[{handler:{name:"comparisonOperators",handle:F,priority:c.COMPARISON_OPERATORS},optionKey:"comparisonOperators"},{handler:{name:"htmlTags",handle:J,priority:c.HTML_TAGS},optionKey:"htmlTags"},{handler:{name:"setextHeadings",handle:rn,priority:c.SETEXT_HEADINGS},optionKey:"setextHeadings"},{handler:{name:"links",handle:S,priority:c.LINKS},optionKey:"links",earlyReturn:n=>n.endsWith("](streamdown:incomplete-link)")},{handler:{name:"boldItalic",handle:Z,priority:c.BOLD_ITALIC},optionKey:"boldItalic"},{handler:{name:"bold",handle:v,priority:c.BOLD},optionKey:"bold"},{handler:{name:"italicDoubleUnderscore",handle:z,priority:c.ITALIC_DOUBLE_UNDERSCORE},optionKey:"italic"},{handler:{name:"italicSingleAsterisk",handle:Y,priority:c.ITALIC_SINGLE_ASTERISK},optionKey:"italic"},{handler:{name:"italicSingleUnderscore",handle:Q,priority:c.ITALIC_SINGLE_UNDERSCORE},optionKey:"italic"},{handler:{name:"inlineCode",handle:V,priority:c.INLINE_CODE},optionKey:"inlineCode"},{handler:{name:"strikethrough",handle:en,priority:c.STRIKETHROUGH},optionKey:"strikethrough"},{handler:{name:"katex",handle:x,priority:c.KATEX},optionKey:"katex"}],Hn=n=>{var e;let r=(e=n==null?void 0:n.linkMode)!=null?e:"protocol";return Wn.filter(({handler:i,optionKey:t})=>i.name==="links"?$(n==null?void 0:n.links)||$(n==null?void 0:n.images):$(n==null?void 0:n[t])).map(({handler:i,earlyReturn:t})=>i.name==="links"?{handler:b(I({},i),{handle:o=>S(o,r)}),earlyReturn:r==="protocol"?t:void 0}:{handler:i,earlyReturn:t})},Dn=(n,r)=>{var a;if(!n||typeof n!="string")return n;let e=n.endsWith(" ")&&!n.endsWith("  ")?n.slice(0,-1):n,i=Hn(r),t=((a=r==null?void 0:r.handlers)!=null?a:[]).map(l=>{var s;return {handler:b(I({},l),{priority:(s=l.priority)!=null?s:c.DEFAULT}),earlyReturn:void 0}}),o=[...i,...t].sort((l,s)=>{var m,B;return ((m=l.handler.priority)!=null?m:c.DEFAULT)-((B=s.handler.priority)!=null?B:c.DEFAULT)});for(let{handler:l,earlyReturn:s}of o)if(e=l.handle(e),s!=null&&s(e))return e;return e},mr=Dn;export{mr as default,d as isWithinCodeBlock,p as isWithinLinkOrImageUrl,h as isWithinMathBlock,f as isWordChar};